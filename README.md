### å‰è¨€

ä¹‹å‰å†™è¿‡ä¸€ç¯‡[åŸºäºJenkinså’ŒFastlaneè‡ªåŠ¨æ‰“åŒ…]()çš„æ–‡ç« ï¼Œæ–‡ä¸­ç®€è¿°äº†å¾ˆå¤šçš„çš„ç¯å¢ƒæ­å»ºä»¥åŠä¸€äº›é‡åˆ°çš„é—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯ä½¿ç”¨è„šæœ¬å’Œ**Jenkins**æ¥è‡ªåŠ¨æ‰“åŒ…ï¼Œä¸ºä½•ä¸åœ¨ä½¿ç”¨ä¹‹å‰çš„**Fastlane**å‘¢ï¼Ÿé¦–å…ˆ**Fastlane**æ˜¯å¾ˆä¸é”™çš„ï¼Œä¹Ÿæ˜¯ä½¿ç”¨**xcodebuild**å‘½ä»¤æ¥å°è£…å®ç°çš„ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªè„šæœ¬çš„è¿ç§»èƒ½åŠ›å³è¿ç”¨åˆ°å…¶ä»–é¡¹ç›®ä¸Šï¼Œæˆ‘è®¤ä¸ºæ˜¯ä¸ç®—é«˜çš„ï¼Œè‡³å°‘åœ¨**Jenkins**ä¸Šã€‚åæ­£**Fastlane**ä¹Ÿæ˜¯åŸºäº**xcodebuild**æ¥è¿›è¡Œç¼–è¯‘æ‰“åŒ…çš„ï¼Œé‚£æˆ‘ä»¬ä½•ä¸ç›´æ¥ç¼–å†™è„šæœ¬è¿›è¡Œæ‰“åŒ…å‘¢ï¼Ÿ

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤§å®¶éƒ½çŸ¥é“ä½¿ç”¨**Git**åŸºäº**Jenkins**çš„è‡ªåŠ¨åŒ–æ‰“åŒ…å¯ä»¥ç›´æ¥åœ¨æ¯æ¬¡æäº¤æ—¶å®ç°è‡ªåŠ¨æ‰“åŒ…ï¼Œä½†æ˜¯åœ¨**Jenkins**ä¸­ä½¿ç”¨**SVN**æˆ‘ä»¬æ²¡æœ‰å‘ç°ç±»ä¼¼è¿™ä¸ªåŠŸèƒ½çš„æ’ä»¶ã€‚æ–‡ä¸­çš„è§£å†³åŠæ³•æ˜¯ä¸€ç§æ›²çº¿æ•‘å›½çš„æ–¹æ³•ï¼Œåœ¨æ–‡ç« çš„ä¸‹åŠéƒ¨åˆ†ä¼šè®²åˆ°ã€‚æˆ‘ä¸€å¼€å§‹çš„æ„æ€è¿˜æ˜¯æƒ³é€šè¿‡å±€åŸŸç½‘æ¥å®ç°ï¼Œä½†æ˜¯è¶Šåˆ°åé¢å‘ç°è¡Œä¸é€šï¼Œæ²¡æœ‰æ„Ÿè§‰åˆ°è‡ªåŠ¨æ‰“åŒ…å¸¦æ¥çš„ä¾¿åˆ©ã€‚**äºæ˜¯æœ‰äº†æœ¬æ–‡è¿™ä¸ªæ–¹æ¡ˆ**ã€‚



### å‡†å¤‡

â‘ è¯·ç¡®ä¿æ‰“åŒ…ç”µè„‘çš„ç¯å¢ƒå·²ç»å®‰è£…å¥½äº†HomeBrewã€Jenkins(å»ºè®®ä½¿ç”¨brewå®‰è£…Jenkinså¹¶è¿›è¡Œå¼€æœºè‡ªå¯åŠ¨)

â‘¡è¯·ç¡®ä¿æ‰“åŒ…ç”µè„‘çš„è¦æ˜¯ä¸²ä¸­æœ‰ä½ éœ€è¦æ‰“åŒ…çš„APPæ‰€éœ€çš„è¯ä¹¦ã€æè¿°æ–‡ä»¶

â‘¢è¯·ç¡®ä¿æ­¤æ‰“åŒ…è„šæœ¬ç”¨äºåŸºäºæäº¤SVNå’ŒJenkinsç¯å¢ƒä¸­è‡ªåŠ¨æ‰“åŒ…ï¼Œå¦åˆ™å°†ä¼šå¯¼è‡´è„šæœ¬ä¸å¯ç”¨çš„çŠ¶æ€ğŸ˜‚ğŸ˜‚



### æ‰“åŒ…ç»“æ„

å…·ä½“çš„ç»“æ„å¯ä»¥å‚ç…§ä¸‹å›¾ï¼Œå¦‚æœæœ‰å…¶ä»–çš„ç±»å‹çš„æ‰“åŒ…ï¼Œå¯ä»¥åœ¨Plistæ–‡ä»¶å¤¹ä¸­æ·»åŠ æ–°çš„plistæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥åœ¨æ‰‹åŠ¨æ‰“åŒ…æ—¶å¯¼å‡ºçš„æ–‡ä»¶å¤¹é‡Œæœ‰xxxExportOptions.plistæ–‡ä»¶ã€‚ç„¶ååœ¨é…ç½®æ–‡ä»¶é‡Œé¢è¿›è¡Œæ›´æ”¹ç±»å‹ã€‚

![](http://cloud.minder.mypup.cn/blog/%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85%E7%BB%93%E6%9E%84%E5%9B%BE.jpg)



#### å‰æˆ

ä¿®æ”¹é…ç½®æ–‡ä»¶å°±èƒ½ç›´æ¥æ§åˆ¶æ‰“åŒ…ç±»å‹æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚ä¸€å¼€å§‹é‡‡ç”¨jsonæ–‡ä»¶æ¥è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨jsonæ–‡ä»¶çš„è¯å¯¹æˆ‘æ¥è¯´æœ‰ä¸¤ä¸ªç¼ºç‚¹ã€‚å…¶ä¸€å°±æ˜¯jsonæ–‡ä»¶ä¸­æ— æ³•è¿›è¡Œæ³¨é‡Šï¼Œè¿™ä¼šå¯¼è‡´åé¢æ¥æ‰‹çš„äººæ— æ³•æ˜ç™½å…¶æ„ï¼Œæˆ–è€…éœ€è¦åœ¨æ·»åŠ ä¸€ä¸ªè¯´æ˜æ–‡æ¡£ï¼›å…¶äºŒæ˜¯å› ä¸ºåœ¨ä½¿ç”¨jsoné…ç½®è·¯å¾„çš„æ—¶å€™è¿˜éœ€è¦å¯¹å€¼è¿›è¡Œå»é™¤åŒå¼•å·ï¼Œå¯ä»¥å®ç°å¾ˆéº»çƒ¦ã€‚å¦å¤–å°±æ˜¯Shellè§£æjsonæ•°æ®è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œä½¿ç”¨jqè§£ææŒºæ–¹ä¾¿å°±æ˜¯å¾—é…ç½®ä¸€ä¸‹ç¯å¢ƒã€‚å…¶ä¸­global.configä»£ç å¦‚ä¸‹ï¼š

```

	#æ˜¯å¦éœ€è¦æ‰“åŒ…
	is_need_package=true

	#ç”Ÿäº§ç¯å¢ƒ/å¼€å‘ç¯å¢ƒè¯ä¹¦è®¾ç½®
	code_sign_distribution="iPhone Distribution: xxxx xxx (xxx)"
	code_sign_development="iPhone Developer: xxxx xxxx (xxx)"

	#é¡¹ç›®çš„target/schemeè®¾ç½® 
	package_target_name="xxx"
	package_scheme_name="xxx"

	#æ‰“åŒ…ç»“æœæ ¹ç›®å½•
	package_root_path=/Users/xxx/Desktop/Package/
	#æ‰“åŒ…ipaç›®å½•
	package_archive_path=/Users/xxx/Desktop/Package/Archive/

	#æ‰“åŒ…ç±»å‹  AdHocï¼š1 AppStoreï¼š2  Enterpriseï¼š3  Developmentï¼š4
	package_export_type=1
	#æ‰“åŒ…å­˜æ”¾çš„xxxExportOptions.plistæ–‡ä»¶å¤¹
	package_export_options_dir_path=./AutoPacking/Plist/

	#æ˜¯å¦ä½¿ç”¨workspaceè¿›è¡Œæ‰“åŒ…
	package_use_workspace=true
	#æ˜¯å¦ä½¿ç”¨Releaseæ¨¡å¼è¿›è¡Œæ‰“åŒ…
	package_use_release=true

	#è®°å½•æ‰“åŒ…å‰ç¼€
	record_perfix="CEG"
```



æ˜¯ä¸æ˜¯è§‰å¾—å¾ˆç®€å•ï¼Œä½†æ˜¯é˜…è¯»æ€§ä¸æ˜¯å¾ˆé«˜å§ï¼Œ åœ¨Xcodeä¸­æ²¡æœ‰é«˜äº®æ˜¾ç¤ºï¼Œéƒ½æ˜¯ä¸€ä¸ªè‰²å®¹æ˜“çŠ¯å›°ã€‚ä½†æ˜¯ä½¿ç”¨è¶…çº§ç®€å•

```
source global.config
```

æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ŒğŸ˜€ğŸ˜€ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤ï¼Œå³å¯è·å¾—å…¨éƒ¨çš„å…¨å±€å˜é‡ï¼Œ$is_need_packageå°±èƒ½è·å¾—å€¼ï¼Œè·¯å¾„ä¹Ÿæ˜¯ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†è¿™ç§æ–¹å¼æ¥è¿›è¡Œåšé…ç½®æ–‡ä»¶ï¼Œå¯¹ä¸åŒçš„äººæœ‰ä¸åŒçš„æ•ˆæœï¼Œå¯¹æˆ‘ä¸ç†Ÿæ‚‰è„šæœ¬çš„äººçœŸçš„å¤ªæœ‰å¥½äº†ã€‚æœ‰ä¸ªæ³¨æ„ç‚¹å°±æ˜¯ä¸€è¡Œåªèƒ½å†™ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”å˜é‡å’Œå€¼ä¹‹é—´åªèƒ½æœ‰ç­‰äºå·ï¼Œä¸èƒ½æœ‰ç©ºæ ¼å·æ¥è¿›è¡Œå¯¹é½ğŸ¤¡ğŸ¤¡ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—è¿æœ€åçš„ç¾åŒ–æœºä¼šéƒ½æ²¡æœ‰å•¦ğŸ˜ã€‚å…¶å®ä¹ æƒ¯å°±å¥½ã€‚ğŸ™‚



#### åæˆ

å°ä¼™å­åˆ«ç›¯ç€çœ‹æ ‡é¢˜å“ˆï¼Œæ€æƒ³å¾ˆå±é™©å“ˆğŸ˜…ï¼Œæˆ‘ä¸æ˜¯æ¥å¼€è½¦çš„ï¼Œè¯´å®Œé…ç½®æ–‡ä»¶å°±è¯¥è¯´è¯´è¿™ä¸ªæ‰“åŒ…è„šæœ¬äº†ã€‚è¿˜è®°å¾—å‡†å¤‡å·¥ä½œä¸­è¯´äº†è¦åœ¨**SVN**ä¸­å—ï¼Œå› ä¸ºç”¨åˆ°äº†Jenkinsä¸­å…¨å±€æ„å»ºå‚æ•°**SVN_REVISION**,å¦å¤–çœ‹è¿™ä¸ªè„šæœ¬å…¶å®æœ‰ç‚¹çƒ¦ï¼Œå› ä¸ºå¾ˆå¤§éƒ¨åˆ†ä»£ç æ˜¯åœ¨åšå‰æˆå·¥ä½œğŸ˜‰ğŸ˜‰ï¼ŒçœŸæ­£**xcodebuild**å‘½ä»¤åœ¨æœ«å°¾äº†ã€‚å¦å¤–æˆ‘å†™è„šæœ¬å–œæ¬¢éƒ½æ˜¯å°å†™ï¼Œå…¨å¤§å†™çš„çœ‹ç€å¤´ç—›å•Šï¼Œ æ‰€ä»¥æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ç¬¦ä¸ç¬¦åˆè„šæœ¬çš„ä»£ç è§„èŒƒå§ï¼Œä½†æ˜¯è‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½ğŸ˜ğŸ˜ã€‚

```
#!/bin/sh

# å½“å‰shellæ‰€å¤„çš„ç›®å½•
shell_dir_path=$(cd "$(dirname "$0")"; pwd)

# æŠŠé…ç½®æ–‡ä»¶é‡Œçš„å‚æ•°åœ¨è¯¥è„šæœ¬é‡Œå…¨å±€åŒ–
source $shell_dir_path"/global.config"

echo "å¼€å§‹æ£€æŸ¥ç¯å¢ƒ..........."

# å¦‚æœå½’æ¡£æ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™åˆ›å»º
if [ ! -d $package_root_path ]; then
    mkdir -pv $package_root_path
fi

# å¦‚æœä¸å­˜åœ¨è®°å½•æ–‡ä»¶åˆ™åˆ›å»ºï¼Œå­˜åœ¨æ–‡ä»¶åˆ™æŠŠæ–‡ä»¶å†…å®¹å˜é‡åŠ å…¥åˆ°å…¨å±€å˜é‡
if [ -e $package_root_path"result.txt" ]; then
    source $package_root_path"result.txt"
    # åˆ¤æ–­svnæœ€åæäº¤ä¿¡æ¯æ˜¯å¦å·²ç»å½’æ¡£è¿‡ï¼Œå…¶ä¸­SVN_REVISIONæ˜¯SVNæäº¤æ—¶çš„ç¼–å·ï¼Œæ”¹å˜é‡
    # æ˜¯Jenkinsæä¾›çš„
    if [ $lastestBuildVersion = $SVN_REVISION ] ; then
        echo "è¯¥ç‰ˆæœ¬å·²ç»æ‰“è¿‡åŒ…äº†ï¼Œè¯·é‡æ–°æäº¤ä¸€æ¬¡è®°å½•å¹¶ç¡®ä¿is_need_packageä¸ºtrue"
        exit 1
    else
        # ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œæ‰€ä»¥æ¯æ¬¡æ‰“åŒ…éƒ½ä¼šåœ¨å¼€å§‹å‰ç§»é™¤ä¹‹å‰æ–‡ä»¶
        rm -rf $package_archive_path*
        echo "ç§»é™¤æ—§é¡¹ç›®å®Œæ¯•ï¼Œå‡†å¤‡å·¥ä½œå·²å°±ç»ª"
    fi
else
    # åˆ›å»ºè®°å½•æ–‡æ¡£
    touch $package_root_path"/result.txt"
    chmod -R 777 $package_root_path"/result.txt"
    echo lastestBuildVersion=0 >> $package_root_path"/result.txt"

fi

# æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰“åŒ…
if ! $is_need_package; then
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦è®¾ç½®target/scheme
if test -z $package_target_name; then
	echo "âŒ é¡¹ç›®Targetè®¾ç½®ä¸ºç©º"
	exit 1
fi

if test -z $package_scheme_name; then
	echo "âŒ é¡¹ç›®Schemeè®¾ç½®ä¸ºç©º"
	exit 1
fi

# è¯»å–é…ç½®æ–‡ä»¶å½’æ¡£ç±»å‹æ˜¯Releaseè¿˜æ˜¯Debug
if $package_use_release; then
    build_configuration="Release"
else
    build_configuration="Debug"
fi


#  AdHoc: 1, AppStore: 2, Enterprise: 3, Development: 4
# å¯¼å‡ºipaåŒ…çš„plistæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶åœ¨æ‰“åŒ…æ—¶ä¼šç”Ÿæˆ
options_dir_path=$package_export_options_dir_path
if [[ $package_export_type -eq 1 ]]; then
    export_options_plist_path=$options_dir_path"AdHocExportOptions.plist"
    export_type_name="AdHoc"
elif [[ $package_export_type -eq 2 ]]; then
    export_options_plist_path=$options_dir_path"AppStoreExportOptions.plist"
    export_type_name="AppStore"
elif [[ $package_export_type -eq 3 ]]; then
    export_options_plist_path=$options_dir_path"EnterpriseExportOptions.plist"
    export_type_name="Enterprise"
elif [[ $package_export_type -eq 4 ]]; then
    export_options_plist_path=$options_dir_path"DevelopmentExportOptions.plist"
    export_type_name="Development"
fi

echo "âœ…âœ…âœ… æ ¡éªŒå‚æ•°ä»¥åŠç¯å¢ƒæˆåŠŸ"
echo "âš¡ï¸ âš¡ï¸ âš¡ï¸å³å°†å¼€å§‹æ‰“åŒ… âš¡ï¸ âš¡ï¸ âš¡ï¸"

##############################è‡ªåŠ¨æ‰“åŒ…éƒ¨åˆ†##############################

# è¿”å›åˆ°å·¥ç¨‹ç›®å½•
cd ../
project_path=`pwd`

# è·å–é¡¹ç›®åç§°
project_name=`find . -name *.xcodeproj | awk -F "[/.]" '{print $(NF-1)}'`
# æŒ‡å®šå·¥ç¨‹çš„Info.plist
current_info_plist_name="Info.plist"
# é…ç½®Info.plistçš„è·¯å¾„
current_info_plist_path="${project_name}/${current_info_plist_name}"
# è·å–é¡¹ç›®çš„ç‰ˆæœ¬å·
bundle_version=`/usr/libexec/PlistBuddy -c "Print CFBundleShortVersionString" ${current_info_plist_path}`
# è·å–é¡¹ç›®çš„ç¼–è¯‘ç‰ˆæœ¬å·
bundle_build_version=`/usr/libexec/PlistBuddy -c "Print CFBundleVersion" ${current_info_plist_path}`

# å½“å‰ç‰ˆæœ¬å­˜æ”¾å¯¼å‡ºæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ·»åŠ ä¸åŒçš„è·¯å¾„
currentVersionArchivePath="${package_archive_path}"

# åˆ¤æ–­å½’æ¡£å½“å‰ç‰ˆæœ¬æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
if [ ! -d $currentVersionArchivePath ]; then
    mkdir -pv $currentVersionArchivePath
    chmod -R 777 $currentVersionArchivePath
fi

# å½’æ¡£æ–‡ä»¶è·¯å¾„
export_archive_path="${currentVersionArchivePath}${package_scheme_name}.xcarchive"
# ipaå¯¼å‡ºè·¯å¾„
export_ipa_path="${currentVersionArchivePath}"
# è·å–æ—¶é—´ å¦‚:20190630_1420
# current_date="$(date +%Y%m%d_%H%M)"
# ipa åå­—, å¯ä»¥æ ¹æ®ç‰ˆæœ¬å·æ¥è¿›è¡Œé‡å‘½å
ipa_name="${package_scheme_name}_${SVN_REVISION}.ipa"

echo "å·¥ç¨‹ç›®å½• = ${project_path}"
echo "å·¥ç¨‹Info.plistè·¯å¾„ = ${current_info_plist_path}"
echo "æ‰“åŒ…ç±»å‹ = ${build_configuration}"
echo "æ‰“åŒ…ä½¿ç”¨çš„plistæ–‡ä»¶è·¯å¾„ = ${export_options_plist_path}"

###############################æ‰“åŒ…éƒ¨åˆ†#########################################

echo "ğŸ”†ğŸ”†ğŸ”†æ­£åœ¨ä¸ºæ‚¨å¼€å§‹æ‰“åŒ…ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€"

# æ˜¯å¦ä½¿ç”¨xxx.xcworkspaceå·¥ç¨‹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…
if $package_use_workspace; then

    if [[ ${build_configuration} == "Debug" ]]; then
        # 1. Clean
        xcodebuild clean  -workspace ${project_name}.xcworkspace \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration}

        # 2. Archive
        xcodebuild archive  -workspace ${project_name}.xcworkspace \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration} \
        -archivePath ${export_archive_path} \
        CFBundleVersion=${bundle_build_version} \
        -destination generic/platform=ios \

    elif [[ ${build_configuration} == "Release" ]]; then

        # 1. Clean
        xcodebuild clean  -workspace ${project_name}.xcworkspace \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration}

        # 2. Archive
        xcodebuild archive  -workspace ${project_name}.xcworkspace \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration} \
        -archivePath ${export_archive_path} \
        CFBundleVersion=${bundle_build_version} \
        -destination generic/platform=ios \

    fi

else

    if [[ ${build_configuration} == "Debug" ]] ; then
        # 1. Clean
        xcodebuild clean  -project ${project_name}.xcodeproj \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration} \
        -alltargets

        # 2. Archive
        xcodebuild archive  -project ${project_name}.xcodeproj \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration} \
        -archivePath ${export_archive_path} \
        CFBundleVersion=${bundle_build_version} \
        -destination generic/platform=ios \

    elif [[ ${build_configuration} == "Release" ]]; then
        # 1. Clean
        xcodebuild clean  -project ${project_name}.xcodeproj \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration} \
        -alltargets

        # 2. Archive
        xcodebuild archive  -project ${project_name}.xcodeproj \
        -scheme ${package_scheme_name} \
        -configuration ${build_configuration} \
        -archivePath ${export_archive_path} \
        CFBundleVersion=${bundle_build_version} \
        -destination generic/platform=ios \

    fi
fi

# æ£€æŸ¥æ˜¯å¦æ„å»ºæˆåŠŸ
# å› ä¸ºxxx.xcarchive æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶
if [ -d ${export_archive_path} ]; then
    echo "ğŸš€ ğŸš€ ğŸš€ é¡¹ç›®æ„å»ºæˆåŠŸ ğŸš€ ğŸš€ ğŸš€"
else
    echo "âš ï¸ âš ï¸ âš ï¸ é¡¹ç›®æ„å»ºå¤±è´¥ âš ï¸ âš ï¸ âš ï¸"
    exit 1
fi

echo "å¼€å§‹å¯¼å‡ºipaæ–‡ä»¶"
# å¯¼å‡ºipaæ–‡ä»¶
xcodebuild -exportArchive -archivePath ${export_archive_path} \
-exportPath ${export_ipa_path} \
-destination generic/platform=ios \
-exportOptionsPlist ${export_options_plist_path} \
-allowProvisioningUpdates
# é»˜è®¤å¯¼å‡ºipaæ–‡ä»¶è·¯å¾„
export_ipa_name=$export_ipa_path$package_scheme_name".ipa"

# åˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªå¯¼å‡ºipaæ–‡ä»¶
if [ -e $export_ipa_name ]; then
    # æ›´æ”¹åç§°ä¸º scheme_version.ipa schemeåç§°ä¸ºå·¥ç¨‹åç§°ï¼Œversionä¸ºsvnæœ€åæäº¤çš„ç‰ˆæœ¬
    mv $export_ipa_name $export_ipa_path$ipa_name
    # å°†å½“å‰ç‰ˆæœ¬è®¾ä¸ºå·²æ‰“åŒ…çŠ¶æ€
    echo lastestBuildVersion=$SVN_REVISION > $package_root_path"result.txt"
    echo "ğŸ‰ ğŸ‰ ğŸ‰ å¯¼å‡º ${ipa_name}.ipa åŒ…æˆåŠŸ ğŸ‰ ğŸ‰ ğŸ‰"
else
    echo "âŒ âŒ âŒ å¯¼å‡º ${ipa_name}.ipa åŒ…å¤±è´¥ âŒ âŒ âŒ"
fi

# è¾“å‡ºæ‰“åŒ…æ€»ç”¨æ—¶
echo "æœ¬æ¬¡æ‰“åŒ…æ€»è€—æ—¶: ${SECONDS}s"
```

æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤´æ™•å“‡ï¼Œæˆ‘æ˜¯å¤´ç—›å•ŠğŸ¤—ğŸ¤—ï¼Œç©è¿‡ä½¿ç”¨**Jenkins**è„šæœ¬è‡ªåŠ¨æ‰“åŒ…çš„äººçœ‹å®Œè¿™ä¸ªåº”è¯¥çŸ¥é“æˆ‘çš„æ›²çº¿æ•‘å›½æ–¹å¼äº†ï¼Œæœ‰çš„åŒå­¦è‚¯å®šè¿˜åœ¨ğŸ˜³ğŸ˜³orğŸ¤”ğŸ¤”ã€‚æˆ‘ä»¬åœ¨**é‡å¤´æˆ**ä¸­è®²ğŸ¤—ğŸ¤—ã€‚



### é‡å¤´æˆ

çœ‹é£æ ¼æˆ‘å°±ä¸æ˜¯å¼€è½¦çš„äººï¼Œå› ä¸ºå¼€è½¦å“ªæ¥è¿™ä¹ˆå¤šå‰æˆæ˜¯å§ï¼ŸğŸ¤”ğŸ¤”ï¼Œå¼€å§‹å‰¥ä¸æŠ½èŒ§å•¦ã€‚

å‰é¢è¯´åˆ°åœ¨**Jenkins**ä¸­æ²¡æœ‰ç±»ä¼¼**Git**è¿™æ ·çš„æäº¤ä»£ç è‡ªåŠ¨æ‰“åŒ…çš„é’©å­æ’ä»¶ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨**Jenkins**çš„ç›®çš„å°±æ˜¯ä¸ºäº†é‡Šæ”¾ç¨‹åºå‘˜çš„ğŸ‘ï¼Œç•™ç€æ›´å¤šæ—¶é—´å¹²æ­£äº‹ï¼Œå¦‚æœä¸èƒ½å®ç°æäº¤è‡ªåŠ¨æ‰“åŒ…é‚£æœ‰æ— **Jenkins**éƒ½ä¸€æ ·äº†ï¼Œè¿˜ä¸å¦‚è‡ªå·±å†™ä¸ªè„šæœ¬æ‰“åŒ…å‘¢ï¼Œæ˜¯å§ï¼Ÿå¦‚æœæ˜¯ä½ ä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ

æˆ‘ä»¬çŸ¥é“Jenkinsæœ‰ä¸ªå®šæœŸæ‰§è¡Œä»»åŠ¡çš„é€‰é¡¹ï¼Œæˆ‘ä»¬åªéœ€å¡«ä¸Šå‚æ•°ï¼šH/2 * * * *  ç„¶åå°±ä¼šæ¯ä¸¤åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œæ˜¯ä¸æ˜¯æƒ³è¯´ä¸ºå•¥ä¸è®¾ç½®1åˆ†é’Ÿï¼Œæˆ‘ä¹Ÿæƒ³å“‡ï¼Œ**Jenkins**ä¸è®©å•ŠğŸ˜ğŸ˜ã€‚ä½†æ˜¯æ€»ä¸èƒ½è®©è¿™å®¶ä¼™æ¯ä¸¤åˆ†é’Ÿä¸€ç›´æ‰“å§ï¼Œè¦†ç›–è¿˜å¥½ï¼Œä½†æ˜¯æ¯ä¸¤åˆ†é’Ÿå°±æœ‰ä¸€ä¸ªæ–°çš„å®‰è£…åŒ…ä¸Šä¼ è‡³æµ‹è¯•æœåŠ¡å™¨ä¹Ÿä¸å¥½å§ï¼Œæ„Ÿè§‰ä¼šè¢«æµ‹è¯•äººå‘˜æ‰“å±ğŸ˜±ğŸ˜±ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è§£å†³è¿™ä¸ªæ‰“æ–­æ‰“åŒ…çš„æ¡ä»¶ğŸ¤”ã€‚æ—¢ä¸èƒ½åœ¨å·¥ç¨‹ä¸­è®¾ç½®ï¼Œä¸ç„¶**Jenkins**æ¯æ¬¡æ‰§è¡Œä»»åŠ¡å°±è¦†ç›–äº†ï¼Œä¹Ÿå°±æ˜¯åªèƒ½åœ¨æ‰“åŒ…ç”µè„‘ä¸Šä¿å­˜ä¸€ä¸ªçŠ¶æ€ã€‚é‚£ä¹ˆå¾ˆå¥½è§£å†³å•¦ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è„šæœ¬ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥è®°å½•ä¸Šæ¬¡æ‰“åŒ…çš„**SVN_REVISION**ï¼Œå°±èƒ½è®©è„šæœ¬è¯»å–æ–‡ä»¶è®°å½•åˆ¤æ–­æ˜¯å¦å·²ç»æ‰“è¿‡åŒ…äº†ï¼Œæ²¡æœ‰æ‰“è¿‡åŒ…æ‰æ‰§è¡Œç¨‹åºï¼Œå¦åˆ™é€€å‡ºç¨‹åºã€‚ğŸ˜‰ğŸ˜‰ç°åœ¨æƒ³æƒ³æ˜¯ä¸æ˜¯å¾ˆç®€å•å“‡ï¼Œç„¶åå°±å¯ä»¥å°½æƒ…çš„å“’å“’å“’ã€‚



ä½¿ç”¨FTPä¸Šä¼ è‡³æµ‹è¯•æœåŠ¡å™¨è¿™éƒ¨åˆ†è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿå› ä¸ºæ¶‰åŠåˆ°å¯å˜å‚æ•°ï¼Œè„šæœ¬é‚£ä¹ˆå·®çš„æˆ‘åªèƒ½ä½¿ç”¨åœŸåŠæ³•ï¼Œä¸€æ‹›ä¸€æ‹›æ¥ï¼Œå¹²åˆ°ä¸æœä¸ºæ­¢ğŸ˜ğŸ˜ã€‚è¿™éƒ¨åˆ†è„šæœ¬æ˜¯ä¸Šé¢é‚£é•¿ä¸²ä»£ç çš„æœ«å°¾åçš„ä»£ç ã€‚

```
############################ä¸Šä¼ éƒ¨åˆ†#####################################

function createUploadShell(){
    touch upload.sh
    chmod -R 777 upload.sh
    echo "cd ${package_archive_path}" >> upload.sh
    echo "ftp -i -n -v << !" >> upload.sh
    echo "open 117.xx.xxx.xxx" >> upload.sh
    echo "user oymuzi xxxx" >> upload.sh
    echo "cd ./${upload_dir_path}" >> upload.sh
    current_date="$(date +%Y%m%d%H%M%S)"
    ipa_new_name=$package_scheme_name"_"$current_date".ipa"
    echo "binary" >> upload.sh
    echo "put ${upload_volumes_name}${package_archive_path}${ipa_name} ./${ipa_new_name}" >> upload.sh
    echo "close" >> upload.sh
    echo "bye" >> upload.sh
    echo "!" >> upload.sh
}

cd $package_archive_path
createUploadShell
echo "åˆ›å»ºä¸Šä¼ è„šæœ¬æˆåŠŸ"

echo "ğŸš€ ğŸš€ ğŸš€ å¼€å§‹ä¸Šä¼ è‡³äº‘ç«¯  ğŸš€ ğŸš€ ğŸš€"
sh upload.sh
echo "ä¸Šä¼ è‡³äº‘ç«¯å®Œæˆ"

rm -f upload.sh
```

å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆfeel å€çˆ½ï¼Œå¤§ä½¬å¯ä»¥è‡ªå·±è¿›è¡Œæ›´æ”¹è„šæœ¬ã€‚å…¶ä¸­ä¸€ç‚¹å°±æ˜¯ä½¿ç”¨FTPå‘½ä»¤å¿…é¡»ä½¿ç”¨`ftp -i -n -v << !  ä½ æƒ³è¦çš„æ‰§è¡Œçš„FTPå‘½ä»¤  !`ã€‚è‡³äºä¸Šä¼ å…¬å¸æœåŠ¡å™¨è¿˜æ˜¯è’²å…¬è‹±ç­‰å¹³å°ï¼Œè¿™ä¸ªå¯ä»¥æ ¹æ®å„è‡ªå…¬å¸çš„è§„åˆ™å§ï¼Œè‡ªå·±è¿›è¡Œä¿®æ”¹å“ˆã€‚



æºç åœ°å€ï¼š[OMPackaging]()(æ³¨ï¼šæ­¤demoä»…ä¸ºäº†å±•ç¤ºæºç ï¼ŒæŒ‰ç…§æºç å’Œæ–‡ç« æ‰€è¯´çš„åŠæ³•è®¾ç½®ç¯å¢ƒå³å¯æ­£å¸¸æ‰“åŒ…)



### è¨€å½’æ­£ä¼ 

åˆ©ç”¨**Jenkins**çš„å®šæ­»æ‰§è¡Œä»»åŠ¡åŠŸèƒ½ï¼Œåœ¨æœ¬åœ°ä¿å­˜ä¸€ä¸ªæ‰“åŒ…çš„çŠ¶æ€ï¼Œç„¶åå°±èƒ½æ¯æ¬¡æäº¤ä»£ç åè¿›è¡Œè‡ªåŠ¨æ‰“åŒ…ï¼Œæœ‰1-2åˆ†é’Ÿçš„å»¶è¿Ÿï¼Œè€Œä¸”è¦æ‰§è¡Œæ‰“åŒ…å¿…é¡»ç¡®ä¿é…ç½®æ–‡ä»¶ä¸­çš„`is_need_package`ä¸ºtrueå¹¶æäº¤ä¸€æ¬¡ä»£ç ã€‚åœ¨ä¸Šä¼ è‡³æµ‹è¯•æœåŠ¡å™¨ï¼Œæµ‹è¯•äººå‘˜å°±èƒ½ç›´æ¥ä¸‹è½½å®‰è£…ã€‚è¿™ä¸ªæ–¹æ¡ˆè™½ç„¶æœ‰äº›å»¶è¿Ÿï¼Œä½†æ˜¯è§£å†³äº†è‡ªåŠ¨æ‰“åŒ…çš„é—®é¢˜ã€‚





å‚è€ƒï¼š

[Mac shell ä¸Šä¼ æ–‡ä»¶(åœ¨shellä¸­ä½¿ç”¨FTPå‘½ä»¤)](https://blog.csdn.net/weixinyi21cn/article/details/79151620)

[Building from the Command Line with Xcode FAQ](https://developer.apple.com/library/archive/technotes/tn2339/_index.html)

